[gd_scene load_steps=3 format=2]

[sub_resource type="GDScript" id=5]
script/source = "extends Spatial

export(float) var speed :float = 0.0 
export(float) var hight :float = 1.0
export(float) var distance : float = 1.0
export(float) var player_hight :float = 1.0 + (1.0 / 2.0)

var count :float = 0.0
var on_floor :bool = true
var i_pos : float
var f_pos :float = 0.0

func _ready():
	$on_floor.force_raycast_update()
	i_pos =  $on_floor.get_collision_point().y  + ($mesh.get_transformed_aabb().size/2.0).y

func _unhandled_input(event):
	if event is InputEventScreenTouch and not event.is_pressed():
		$on_floor.transform.origin.z = -distance
		i_pos = $on_floor.get_collision_point().y  + ($mesh.get_transformed_aabb().size/2.0).y
		jump()

func _process(delta):
	i_pos =  $on_floor.get_collision_point().y  + ($mesh.get_transformed_aabb().size/2.0).y
	anim_jump(delta)
#	if not (i_pos - f_pos < 0.9):
#		print(str(i_pos) + \" \" + str(i_pos + f_pos))

func anim_jump(var delta: float):
	if not on_floor:
		if count > distance:
			count = 0
			on_floor = true

		var value_higth :float = ((hight)/pow(distance/2.0, 2.0))

		var function_squary =  -pow((count),2.0) + distance * (count)

		f_pos = value_higth * function_squary 
		
		transform.origin.y = i_pos + f_pos
		
		count += delta * speed

func jump():
	on_floor = false
"

[sub_resource type="CapsuleMesh" id=1]

[node name="player" type="Spatial"]
script = SubResource( 5 )
speed = 0.5
hight = 8.0

[node name="mesh" type="MeshInstance" parent="."]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0 )
mesh = SubResource( 1 )

[node name="on_floor" type="RayCast" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.5, 0 )
enabled = true
cast_to = Vector3( 0, -10, 0 )
collide_with_areas = true
collide_with_bodies = false
debug_shape_custom_color = Color( 0, 0.156863, 1, 1 )

[node name="forward" type="RayCast" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.5, -1 )
enabled = true
cast_to = Vector3( 0, -0.1, 0 )
collide_with_areas = true
collide_with_bodies = false
debug_shape_custom_color = Color( 0.290196, 1, 0, 1 )

[node name="backward" type="RayCast" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.5, 1 )
enabled = true
cast_to = Vector3( 0, -0.1, 0 )
collide_with_areas = true
collide_with_bodies = false
debug_shape_custom_color = Color( 0.290196, 1, 0, 1 )
